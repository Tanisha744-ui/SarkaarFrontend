<div class="game-wrapper">

  <!-- ================= STEP 0 : PLAYER COUNT ================= -->
  <div class="card" *ngIf="step === 0">
    <h1>ğŸ•µï¸ Imposter Game</h1>
    <p class="subtitle">How many players are joining?</p>

    <input type="number" [(ngModel)]="playerCount" min="3" />
    <button class="primary" (click)="setPlayerCount()">Continue</button>
  </div>

  <!-- ================= STEP 1 : PLAYER NAMES ================= -->
  <div class="card" *ngIf="step === 1">
    <h2>Add Player {{ currentPlayerIndex + 1 }}</h2>

    <input [(ngModel)]="tempName" placeholder="Enter player name" />
    <button class="primary" (click)="addPlayerName()">Add Player</button>

    <div class="players-list" *ngIf="playerNames.length">
      <h4>Players</h4>
      <span class="player-pill" *ngFor="let n of playerNames">{{ n }}</span>
    </div>

    <button class="success" *ngIf="currentPlayerIndex >= playerCount" (click)="createGame()">
      Create Game
    </button>
  </div>

  <!-- ================= STEP 3 : WAITING ROOM ================= -->
  <div class="card" *ngIf="step === 3">
    <h2>ğŸ® Waiting Room</h2>
    <p>Let's Start</p>
    <button class="primary" (click)="startGame()">Start Game</button>
  </div>

  <!-- ================= PASS DEVICE (CLUE + VOTE) ================= -->
  <!-- âŒ WILL NOT SHOW ON RESULT STEP -->
  <div class="card warning" *ngIf="showPassScreen && step !== 7">

    <h2>ğŸ“² Pass the Device</h2>
    <p>Hand over to</p>
    <h3>
      {{ step === 4.5
      ? players[nextPlayerIndex]?.name
      : players[voteTurnIndex]?.name }}
    </h3>

    <button class="primary" (click)="step === 4.5 ? proceedToNextClue() : proceedToNextVote()">
      I'm
      {{ step === 4.5
      ? players[nextPlayerIndex]?.name
      : players[voteTurnIndex]?.name }}
    </button>
  </div>

  <!-- ================= STEP 4 : CLUE PHASE ================= -->
  <div class="card" *ngIf="step === 4 && !showPassScreen">
    <h2>ğŸ§  Clue Phase</h2>

    <!-- CURRENT PLAYER -->
    <div *ngIf="isMyClueTurn()">
      <p class="highlight">Your Word</p>
      <h3>{{ word }}</h3>

      <p class="imposter" *ngIf="isImposter">
        ğŸ˜ˆ You are the IMPOSTER
      </p>

      <input [(ngModel)]="myClue" placeholder="Enter your clue..." />
      <button class="primary" (click)="submitClue()">Submit Clue</button>
    </div>

    <!-- WAITING -->
    <div *ngIf="!isMyClueTurn()">
      <p>Waiting for</p>
      <h3>{{ players[clueTurnIndex]?.name }}</h3>

      <button class="secondary" (click)="switchToCurrentTurnPlayer()">
        I'm {{ players[clueTurnIndex]?.name }}
      </button>
    </div>
  </div>

  <!-- ================= STEP 5 : ALL CLUES ================= -->
  <div class="card" *ngIf="step === 5">
    <h2>ğŸ“ All Clues</h2>

    <div class="clue-list">
      <div class="clue-item" *ngFor="let p of players">
        <span class="clue-name">{{ p.name }}</span>
        <span class="clue-separator">:</span>
        <span class="clue-text">{{ p.clue }}</span>
      </div>

    </div>

    <button class="primary" (click)="proceedToVotingPhase()">
      Proceed to Voting
    </button>
  </div>

  <!-- ================= STEP 6 : VOTING ================= -->
  <div class="card" *ngIf="step === 6 && !votePhaseComplete">
    <h2>ğŸ—³ï¸ Voting Time</h2>
    <p>Select who you think is the Imposter</p>

    <!-- ===== CURRENT VOTER ===== -->
    <div *ngIf="players[voteTurnIndex]?.playerId === playerId">

      <button *ngFor="let p of players" class="vote-btn" [class.self-vote]="p.playerId === playerId"
        [disabled]="p.playerId === playerId" (click)="vote(p.playerId)">

        <span *ngIf="p.playerId !== playerId">
          Vote {{ p.name }}
        </span>

        <span *ngIf="p.playerId === playerId">
          {{ p.name }} (You)
        </span>

      </button>

    </div>

    <!-- ===== WAITING ===== -->
    <div *ngIf="players[voteTurnIndex]?.playerId !== playerId">
      <p>Waiting for</p>
      <h3>{{ players[voteTurnIndex]?.name }}</h3>

      <button class="secondary" (click)="switchToVoteTurnPlayer()">
        I'm {{ players[voteTurnIndex]?.name }}
      </button>
    </div>
  </div>


  <!-- ================= STEP 7 : RESULT ================= -->
  <div class="card result" *ngIf="step === 7">
    <h2>ğŸ† Game Result</h2>

    <p>
      Imposter:
      <span class="imposter-name">{{ getImposterName() }}</span>
    </p>

    <h3 *ngIf="result?.imposterCaught" class="success-text">
      ğŸ‰ Imposter Caught!
    </h3>

    <h3 *ngIf="!result?.imposterCaught" class="danger-text">
      ğŸ˜ˆ Imposter Escaped!
    </h3>
  </div>

  <div *ngIf="showPassCard" class="pass-device-overlay">
    <div class="pass-card">
      <h2>Pass the device to:</h2>
      <p>
        <strong>
          {{ phase === 'clue' ? 'Player ' + (currentTurn + 1) + ' for clue' : 
             phase === 'vote' ? 'Player ' + (currentTurn + 1) + ' for voting' : '' }}
        </strong>
      </p>
      <button class="primary" (click)="confirmPass()">I'm Ready</button>
    </div>
  </div>

</div>